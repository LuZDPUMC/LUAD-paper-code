# LUAD-paper-code
Multi-omics data-based modeling reveals tumorigenesis- and prognosis-associated genes with clinical potential in lung adenocarcinoma

# GTEX+TCGA_data_analysis.R
This comprehensive R script pipeline is designed to analyze gene expression differences between normal and tumor tissues (LUAD) using integrated GTEx and TCGA data. The workflow consists of four major steps: (1) Data arrangement: The expression matrix was preprocessed by removing genes with low expression (expressed in less than 50% of samples), imputing missing values using the K-nearest neighbors (KNN) algorithm, and averaging duplicated genes. The data were then log2-transformed to reduce variance and approximate normality, and a curated list of genes of interest was used to extract a refined expression matrix for downstream analysis. (2) Differential expression analysis: Differential expression between normal tissues (n = 347) and tumor tissues (n = 515) was assessed using the Wilcoxon rank-sum test. For each gene, the mean expression, log fold change (logFC), p-value, and median difference were calculated. False discovery rate (FDR) correction was applied to control for multiple testing. Genes with an absolute logFC > 1 and FDR < 0.05 were considered significantly differentially expressed. The complete results were saved as all.xls, and the list of significant differentially expressed genes (DEGs) was saved as diff.xls. A matrix containing expression values of significant DEGs (diffGeneExp.txt) was prepared for visualization. (3) Heatmap visualization: A ranked transformation was applied to the expression matrix of significant DEGs to normalize value distribution before visualization. The pheatmap package was used to generate a heatmap with sample type annotations (normal vs tumor), and the final heatmap was saved as a PDF file. (4) Volcano plot visualization: The DEG data were further visualized using a volcano plot to highlight significantly upregulated and downregulated genes. Genes were categorized as "Up", "Down", or "Not" based on logFC and FDR thresholds. The plot was created using ggplot2 and exported as a PDF.



# TCGA_ATAC_LUAD_data_analysis.R
This comprehensive R code pipeline is designed to systematically analyze TCGA-LUAD (lung adenocarcinoma) ATAC-seq data, covering steps from data preparation to differential peak annotation. First, it processes and normalizes the ATAC-seq expression matrix, extracts peak coordinates, and constructs a peak matrix for downstream analyses. Then, using genome visualization tools (karyoploteR), it generates global genomic coverage plots. Next, it performs functional annotation of peaks and visualizes the distribution using pie charts, bar charts, upset plots, TSS distance plots, heatmaps, and average profile curves. Functional enrichment analyses (GO and KEGG) are conducted on peak-associated genes to explore biological processes and signaling pathways. Finally, the pipeline identifies differentially accessible peaks (diff peaks) between sample groups, annotates them in detail, and saves the results. Overall, this workflow provides a complete framework for exploring chromatin accessibility patterns, functional enrichment, and potential clinical implications in ATAC-seq data from lung adenocarcinoma.


# TCGA_DEGs_Diffpeekgenes.R
This code performs two main steps. First, it identifies the intersection of differentially expressed genes (DEGs) from RNA-seq and differential peak-associated genes from ATAC-seq using a Venn diagram. This intersection represents genes that are both transcriptionally and epigenetically altered. Second, the code extracts RNA-seq expression data for these intersected genes from a DEG expression matrix. The final expression matrix (veengenexpr.txt) is prepared for use in downstream diagnostic model construction such as SVM, RF, or ANN.


# LUAD_Predictive Model_code.R
This code implements a comprehensive workflow for gene feature selection, model construction, prediction, and validation using multiple machine learning methods. First, it applies Random Forest to select important genes from input gene expression data and visualizes their importance. Then, it uses LASSO regression for feature gene selection and cross-validation to identify the optimal regularization parameter, outputting key genes and their expression profiles. Next, it calculates gene scores based on differential expression to build sample features, and trains an Artificial Neural Network (ANN) model for sample classification, evaluating accuracy and visualizing the model on the training set. Finally, it performs gene scoring and ANN prediction on an independent test dataset, and evaluates the model's predictive performance on the test set via ROC curve analysis, reporting the AUC and confidence intervals. This pipeline integrates multiple machine learning techniques to achieve end-to-end gene selection and model validation.

# LUAD_Prognostic Model_code.R
The provided code performs a comprehensive survival analysis workflow using gene expression and clinical data. It begins by identifying significantly differentially expressed genes between normal and tumor samples through Wilcoxon tests and visualizes their expression in a heatmap. Next, it conducts Kaplan-Meier survival analysis to compare survival outcomes between high- and low-risk patient groups, followed by calibration curve plotting to evaluate the predictive accuracy of Cox proportional hazards models at multiple time points. The code also generates risk score plots, survival status scatterplots, and heatmaps to visualize patient risk stratification and gene expression patterns. Independent prognostic analyses are performed using univariate and multivariate Cox regression to identify significant clinical and molecular predictors, with results presented as forest plots. Finally, a nomogram is constructed integrating risk scores and clinical variables to predict individual patient survival probabilities, accompanied by calibration curves and concordance index assessment to validate model performance.

# TCGA_LUAD_SNV_TMB_related_analysis.R
This complete code workflow is divided into five main parts. Its goal is to download, merge, and analyze mutation data (MAF files) from TCGA-LUAD (lung adenocarcinoma), calculate tumor mutational burden (TMB), and integrate TMB with risk scores for survival analysis and visualization.
1️⃣ SNV data download and merging
Sets the working directory and defines a merge_maf function to batch-read TCGA MAF files and merge them into a single large matrix (via row binding).Defines a FilterDuplicate function to remove duplicate samples, ensuring only one record per sample.Reads the sample sheet for MAF files, performs column name formatting (convert to lowercase, replace dots, remove spaces).Calls merge_maf to merge all sample MAF files into one comprehensive mutation matrix and saves it as combined_maf_value.txt.
2️⃣ Calculate TMB (Tumor Mutational Burden)
Reads the merged MAF file and uses the tmb function from the maftools package to calculate TMB for each sample.Saves the calculated TMB values to TMB_log.txt for downstream analysis.
3️⃣ Analysis of the relationship between risk model and TMB
Sets the working directory, reads in the risk file (risk.train.txt) and TMB file (TMB.txt).Formats sample barcodes (keeping only the first 12 characters), removes duplicate samples, and merges TMB data with risk scores.Transforms TMB values using log2(TMB + 1), and retains only intersecting samples.Draws a boxplot comparing TMB between high- and low-risk groups, including statistical test annotations.Draws a scatter plot of TMB versus risk scores, with Spearman correlation analysis.
4️⃣ TCGA-LUAD mutation plotting analysis
Uses the TCGAbiolinks package to download TCGA-LUAD mutation data (Masked Somatic Mutation) from GDC.Generates summary plots, waterfall plots (oncoplots), somatic interaction plots, and gene cloud plots using the maftools package.Calculates and saves a new TMB table.
5️⃣ Survival analysis for combined TMB and risk scoreReads risk and TMB files, aligns and merges samples.Determines optimal cutoff for TMB using surv_cutpoint and classifies samples into high TMB (H-TMB) and low TMB (L-TMB).Creates combined groups considering both TMB status and risk score (e.g., H-TMB+high risk).Defines a bioSurvival function to generate survival curves for each group and save them as PDF files, providing both TMB-only and combined TMB-risk group survival curves.


# LUAD_Prognostic Model_GSEA_and_immune_related analysis_1.R
This code comprehensively investigates the relationship between prognostic risk scores and the tumor immune microenvironment in lung adenocarcinoma (LUAD). First, gene set enrichment analysis (GSEA) identifies biological pathways enriched in high- and low-risk groups. Then, ESTIMATE scores are computed to assess the tumor microenvironment and compared between risk groups. Further analyses explore the differences in immune cell infiltration, immune-related functions, and immune checkpoint gene expression, as well as their correlations with risk scores. Survival analyses of immune cell infiltration are performed to evaluate prognostic implications. Additionally, ssGSEA is employed to profile immune-related pathway activities, highlighting immune activity differences across risk groups. Collectively, these analyses elucidate potential immunological mechanisms underlying risk stratification and provide insights for precision immunotherapy.


# LUAD_Prognostic Model_GSEA_and_immune_related analysis_2.R
This code systematically investigates drug sensitivity, microsatellite instability (MSI), TIDE scores, and immune response profiles between high- and low-risk groups defined by the LUAD (lung adenocarcinoma) prognostic model, aiming to elucidate potential therapeutic vulnerabilities and immune microenvironment heterogeneity.

1️⃣ Drug Sensitivity Analysis
By integrating TCGA-LUAD gene expression data with drug response data from the GDSC (Genomics of Drug Sensitivity in Cancer) database, the oncoPredict tool was employed to estimate the sensitivity (IC50) of LUAD samples to various anti-cancer drugs. Combined with risk scores, boxplots were generated to visualize and identify drugs with significant differential sensitivity between high- and low-risk groups, providing evidence for potential personalized therapeutic strategies.

2️⃣ MSI Analysis
Based on MSI (microsatellite instability) status, the distribution of different MSI subtypes (MSS, MSI-L, MSI-H) between risk groups was compared using stacked barplots. Additionally, boxplots were constructed to illustrate risk score distributions across MSI subtypes, revealing associations between MSI status and risk stratification, which may have implications for immunotherapy responsiveness.

3️⃣ TIDE Analysis
The TIDE (Tumor Immune Dysfunction and Exclusion) framework was utilized to evaluate immune escape potential and dysfunction status between risk groups. Differences in overall TIDE scores, dysfunction, exclusion, CAF, MDSC, TAM M2, IFNG expression, and other immune-related signatures were systematically analyzed using violin plots with statistical comparisons. This analysis provides insights into immune responsiveness and potential sensitivity to immunotherapy in different risk subgroups.

4️⃣ TCIA Immune Response Score Analysis
Using immunogenicity scores (IPS) from the TCIA (The Cancer Immunome Atlas) database, the study compared IPS values under different combinations of CTLA4 and PD-1 status between risk groups. Violin plots with significance testing were used to depict differences in immune response capacity, offering clues to potential clinical benefits of immune checkpoint inhibitors across risk stratifications.


# LUAD_singlecell_Seurat.R
This code performs single-cell RNA-seq analysis, including data preprocessing, quality control, dimensionality reduction, clustering, cell type annotation, differential gene expression analysis, and hub gene visualization.
🟢 01. Data preprocessing and quality control
Imported the single-cell expression matrix and converted it into a numeric matrix, merging duplicate genes.Created a Seurat object, filtering for genes expressed in at least 10 cells and cells expressing at least 200 genes.Calculated the percentage of mitochondrial genes per cell and generated violin plots showing distributions of gene count, UMI count, and mitochondrial gene percentage.Generated scatter plots to examine correlations between nCount_RNA and percent.mt, and between nCount_RNA and nFeature_RNA, to identify potential doublets or low-quality cells.Filtered out low-quality cells with extreme feature counts or high mitochondrial content.Normalized the data (LogNormalize) and identified highly variable genes.

🔵 02. Data scaling and PCA
Scaled the data (without centering or scaling) while regressing out orig.ident and percent.mt effects.Performed PCA on the top variable genes, extracting 50 principal components.Plotted PC loadings, PCA scatter plots, heatmaps for top PCs, JackStraw plots, and an elbow plot to select significant principal components.

🟠 03. TSNE clustering and marker gene analysis
Identified neighbors and performed clustering (FindClusters) based on selected PCs, followed by t-SNE for dimensionality reduction and visualization.Exported TSNE cluster results and visualized sample distributions on TSNE plots.Identified cluster-specific marker genes (FindAllMarkers), filtered significant markers, and exported results.Generated heatmaps and dot plots for the top 5 markers per cluster.For each cluster, generated violin plots, feature plots, and ridge plots of the top 4 marker genes.

🟣 04. Cell type annotation with SingleR
Annotated clusters using SingleR with reference data (e.g., Human Primary Cell Atlas).Saved cluster annotation results and assigned cell-level annotations.Updated Seurat cluster identities using SingleR annotations and visualized TSNE plots labeled by cell type.Exported normalized expression matrix.Identified and exported differentially expressed genes for each cell type.

🔴 05. Visualization of hub genes
Imported a list of hub genes and visualized their expression using:Violin plots (distribution across cell types/clusters).Feature plots (spatial expression on t-SNE).Dot plots (expression and percentage of expressing cells).
